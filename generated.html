<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <!-- Component CSS -->
    <style>
      
    </style>
    <!-- /Component CSS -->
    <!-- Page CSS -->
    <style>
      
    </style>
    <!-- /Page CSS -->
    <!-- Head HTML -->
    
    <!-- /Head HTML -->
    <script>
      var simplyDataApi = {};
      var simplyApp = {};
      window.addEventListener("simply-content-loaded", function() {
        simply.bind = false;
        /* Raw API */
        var simplyRawApi = {
          
        };
        /* End of Raw API */
        /* Data API */
        simplyDataApi = {
          
        };
        /* End of Data API */
        simplyApp = simply.app({
          /* Actions */
          actions: {
            "displayFile" : async function(){
            	console.log("played an action")
            }
          },
          /* /Actions */
          /* Commands */
          commands: {
            "parseFile" : async function(el, value) {
              console.log(el)
              console.log(value)
            
              let form = document.querySelector('form[data-js="convert"]')
              console.log(form)
            
              let output = document.getElementById("result")
            
              let file = document.getElementById("inputFile").files[0]
            
              console.log("got a file!")
              console.log(file)
            
            /*
              function reader(file, callback) {
                const fr = new FileReader();
                fr.onload = () => callback(null, fr.result);
                fr.onerror = (err) => callback(err);
                fr.readAsText(file);
              }
              */
              
              const reader = new FileReader();
            
              function readfile(file){
                reader.onload = (evt) => {
                  return evt.target.result;
                  console.log(evt.target.result);
                };
                reader.readAsText(file);
              }
            
              console.log("file is loaded")  
            
              let fileContent = readfile(file)
              
              console.log("FileContent", fileContent) //undefined
            
              let yogData = JSON.parse(fileContent)
            
              let displayContent = "";
            
              console.log(Object.entries(yogData))
            
              for (const [key, value] of Object.entries(yogData)) {  
                console.log(`${key}: ${value}`);
                displayContent += "<span>" +  "Hello" + "</span>";
                console.log("ohay!")
              }
            
              console.log(displayContent)
            
              output.innerHTML = "hello!" 
              console.log("command sent")
            
              this.app.actions.displayFile(); //todo: refactoring
            }
          },
          /* /Commands */
          /* Routes */
          routes: {
            "/" : function() {
              editor.pageData.page = 'homepage'
            }
          }
          /* /Routes */
        });
      });
      function clone(ob) {
        return JSON.parse(JSON.stringify(ob));
      }
      function updateDataSource(name) {
        document.querySelectorAll('[data-simply-data="'+name+'"]').forEach(function(list) {
          editor.list.applyDataSource(list, name);
          list.dataBindingPaused = 0;
        });
      }
    </script>
  </head>
  <body>
    <!-- Body HTML -->
    
    <!-- /Body HTML -->
    <!-- Component HTML templates -->
    <template id="header">
      
    </template>
    <template id="menu">
      
    </template>
    <template id="upload-file">
      <h2>upload-file interface</h2>
    
    <h3>todolist</h3>
    <ul>
      <li>Find out how to cache stuff <a href="https://developer.mozilla.org/en-US/docs/Web/API/Cache">cache mdn docs</a></li>
      <li>will need to check if there's enough room in the cache -> StorageManager.estimate()</li>
    </ul>
    
    <style>output {font-family: monospace;white-space: pre;}</style>
    
    <form data-js="convert">
        <input id="inputFile" name="file" required type="file" />
        <button data-simply-command="parseFile">Submit</button>
    </form>
    
    <div id="result"></div>
    </template>
    <!-- /Component HTML templates -->
    <header data-simply-path="/" data-simply-field="header" data-simply-content="template" data-simply-default-value="Header">
      <template data-simply-template='Header' rel="header"></template>
    </header>
    <nav>
      <simply-render rel="menu"></simply-render>
    </nav>
    <div class="main" data-simply-field="page" data-simply-content="template">
    <!-- Page HTML templates -->
    <template data-simply-template="homepage">
      <h1>YOG</h1>
    <div>
      <simply-render rel="upload-file"></simply-render>
    </div>
    </template>
    <!-- /Page HTML templates -->
    </div>
    <script src="https://cdn.jsdelivr.net/gh/SimplyEdit/simplyview/dist/simply.everything.js"></script>
    <script src="https://canary.simplyedit.io/1/simply-edit.js" data-simply-storage="none" data-api-key="muze"></script>
    <script>
      /* Transformers */
      editor.transformers = {
        
      };
      /* /Transformers */
    </script>
    <script>
      /* Sorters */
      editor.sorters = {
        
      };
      /* /Sorters */
    </script>
    <script>
      window.addEventListener("simply-content-loaded", function() {
        /* Data sources */
        
        /* /Data sources */
      });
    </script>
    <!-- Foot HTML -->
    
    <!-- /Foot HTML -->
  </body>
</html>